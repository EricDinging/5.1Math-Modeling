[TOC]

### 模型-运筹学-规划论-双层规划【czy】

### 1. 模型名称

双层规划（Bilevel Programming Problem，简称 BLPP）

### 2. 模型概念

是⼀种具有⼆层递阶结构的系统优化问题，上层问题和下层问题都有各⾃的决策变量、约束条件和⽬标函数。双层规划是多层规划（Multilevel Programming）中的⼀个特例，同时多层规划可以看作是⼀系列的双层规划的复合。

双层系统优化研究的是具有两个层次系统的规划与管理问题。上层决策者只是通过⾃⼰的决策去指导下层决策者，并不直接⼲涉下层的决策；⽽下层决策者只需要把上层的决策作为参数，他可以在⾃⼰的可能范围内⾃由决策。这种决策机制使得上层决策者在选择策略以优化⾃⼰的⽬标达成时，必须考虑到下层决策者可能采取的策略对⾃⼰的不利影响。

### 3. 模型形式和参数说明

在双层规划模型中，不同的决策者控制着相应的决策变量，并优化各⾃的⽬标函数。上层决策者⾸先进⾏决策，这样上层决策者必须预测到下层可能的反应。下层根据上层的决策进⾏反应，以优化个⼈的⽬标函数。因为双⽅可供选择的策略集是相互依赖的，上层的决策会影响下层可选的决策和⽬标的实现，反之亦然。

设上层决策者控制的变量为
$$
x=(x_1,x_2,\cdots,x_n)^T\in X\subset R^n
$$
下层决策者控制的变量
$$
y=(y_1,y_2,\cdots,y_n)^T\in Y\subset R^n
$$
下层以最优解反馈到上层的双层规划数学模型为:
$$
\underset{x\in X,y}{min} F(x,y) ----(1)\\

s.t.G(x,y)\leq 0(\text{其中}y\text{解})----(2) \\

\underset{y}{min}f(x,y)----(3)\\

s.t.g(x,y)\leq 0----(4)\\
$$

### 4. 模型特点

1. 层次性：研究的系统是分层管理的，各层决策者依次做出决策，下层服从上层。
2. 独⽴性：各层决策者各⾃控制⼀部分决策变量，以优化各自的目标。
3. 冲突性：各层决策者有各自不同的⽬标，且这些⽬标往往是相互⽭盾的。
4. 优先性：上层决策者优先做出决策，⽽下层决策者在优化⾃⼰的⽬标⽽选择决策时，不能违背上层的决策。

### 5. 模型变种

#### 5.1 线性双层规划

##### 5.1.1 模型名称

线性双层规划（Linear Bilevel Programming，简称  LBM）

##### 5.1.2 模型概念

是双层规划的⼀个特例，其上、下层⽬标函数和约束条件都是线性的，是双层规划中最为常见且形式最为简单的⼀种情况，在实际中应⽤⼗分⼴泛，主要涉及管理决策、交通⽹络布局、⼯程设计等诸多⽅⾯。

##### 5.1.3 求解方法

###### 5.1.3.1 极点算法

极点搜索思想的理论基础是线性双层规划的最优解必在诱导域的极点处取得。⾸先可以利⽤各种⽅法来寻找诱导域的极点，然后从中再找出线性双层规划问题的局部最优解或全局最优解。

###### 5.1.3.2 分枝定界法

其基本思路是，根据事先选定的分枝准则，将所求解的问题分成⼀系列⼦问题，并从中选取⼀个⼦问题进⾏检验，决定其取舍。分枝定界法计算量很⼤，但它能求得全局最优解。

###### 5.1.3.3 K-T 法

其基本思路是将线性双层规划问题中的下层规划问题⽤它的 Kuhn ⼀ Tucke: 条件代替，将线性双层规划问题化为单层⾮线性规划问题求解，最初⽤于求解线性双层资源控制问题。这种算法仅对线性约束的上层和凸⼆次规划的下层这种特殊情况有效。

###### 5.1.3.4 模糊数学算法

其基本思路是充分利⽤模糊集理论中⾪属函数及模糊算⼦的概念和性质，分别建⽴上层决策变量的⾪属函数和上、下层决策者⽬标函数的偏好⾪属函数，双层决策问题转化为单层优化问题，分别对各单层规划的解进⾏讨论，最终把线性双层规划转化为求解⼀个线性规划问题，求得两层决策问题的满意解。

#### 5.2 凸双层规划

##### 5.2.1 模型名称

凸双层规划（Convex Bilevel  Programming）

##### 5.2.2 模型概念

即上层⽬标函数是凸函数，下层⽬标函数是凸⼆次函数，约束条件均为线性的⼀类非线性双层规划。对这类问题，在⼀定条件保证下，将原问题转化为⼀个单层的数学规划，通过对其对应的松弛问题有关性质的讨论，给出恰当的定界规则和分⽀原则，隐含地考虑到互补松弛条件的所有组合，利⽤分⽀定界技术给出⼀种求全局解的算法。

#### 5.3 混合整数线性双层规划

整数规划⼀类要求问题中的全部或⼀部分变量为整数的数学规划。⼀般认为⾮线性的整数规划可分成线性部分和整数部分，因此常常把整数规划作为线性规划的特殊部分。在线性规划问题中，有些最优解可能是分数或⼩数，但对于某些具体问题，常要求解答必须是整数。例如，所求解是机器的台数，⼯作的⼈数或装货的车数等。为了满⾜整数的要求，初看起来似乎只要把已得的⾮整数解舍⼊化整就可以了。实际上化整后的数不见得是可⾏解和最优解，所以应该有特殊的⽅法来求解整数规划。在整数规划中，如果所有变量都限制为整数，则称为纯整数规划；如果仅⼀部分变量限制为整数，则称为混合整数规划。

#### 5.4 非线性双层规划

##### 5.4.1 模型名称

非线性双层规划 (Non-linear Bilevel Programming，简称 NLBP) 

##### 5.4.2 一般形式和参数说明

$$
\underset{x\in X,y}{min} F(x,y) ----(5)\\

s.t.G(x,y)\leq 0(\text{其中}y\text{解})----(6) \\

\underset{y}{min}f(x,y)----(7)\\

s.t.g(x,y)\leq 0----(8)\\
$$

其中，$x\in R^{n_1},y\in R^{n_2}$。则上层变量 $x\in R^{n_1}$ ，下层变量 $y\in R^{n_2}$。

同样，函数$F:R^{n_1}\times R^{n_2}\rightarrow R$ 、$f:R^{n_1}\times R^{n_2}\rightarrow R$ 分别是上层、下层⽬标函数，

而向量值函数 $G:R^{n_1}\times R^{n_2}\rightarrow R^{m_1} 、g:R^{n_1}\times R^{n_2}\rightarrow R^{m_2}$分别是上层、下层约束条件。上层约束条件中包含着来自两层变量 (与⽤ $X$表⽰的约束不同) 是⼀个特殊的⾓⾊，因为这些条件不能约束下层决策者，它们不直接的被**强制**执⾏。

如果上下层⽬标函数$F(x,y)$、$f(x,y)$ ⾄少有⼀个非线性的，称之为非线性双层规划。此外，如果上下层变量在增加整数约束，称之为整数双层规划。

### 6. 模型应用

**双层规划在区域港口内陆运输网络上的应用**

#### 6.1 基本参数

$n$：可以建设港⼜内陆集散中⼼的潜在地点的数量; 

$\alpha$ ：在第 *j* 地建港⼜内陆集散中⼼的最⼤允许容量; 

$f_j^1$ ：在第 *j* 地建内陆集散中⼼的固定成本费⽤; 

$f_j(a_j)$ ：在第 *j* 地建内陆集散中⼼的变动成本费⽤; 

$c_{ij}$ ：从⽣产地 *i* 到内陆集散中⼼ *j* 的单位运输费⽤; 

$g_{ij}$：从内陆集散中⼼ *j* 到出⼜港 *k* 的单位运输费⽤; 

$p_i$ ：⽣产地 *i* 的⽣产量; 

$q_k$：出⼜港 *k* 的容量;

$d$：总运输需求量。

#### 6.2 决策变量

$y_j:y_j=1$表⽰在第 *j* 地建内陆集散中⼼，$y_j=0$ 表⽰在第 *j* 地不建内陆集散中⼼；

$a_j$ ：表⽰在第 *j* 地建内陆集散中⼼的容量；

$x_{ij}$：货物从⽣产地 *i* 到集散中⼼ *j* 的运输量；

$z_{jk}$ ：货物从集散中⼼ *j* 到出⼜港 *k* 的运输量。

#### 6.3 建模过程

上层规划可以描述为物流规划部门在满⾜运输总需求的条件下确定货物集散中⼼的数量和规模, 使得总成本 (固定成本和变动成本) 最⼩;  下层规划描述了在多个货物集散中⼼和出⼜港⼜存在的条件下，物流服务企业的运输量在不同运输路线的分配，使得物流服务企业的总运输成本最⼩。

   对于上层规划来说, 其数学模型为:
$$
(9)---minS=\sum_{f=1}^{n}(f^1_fy_f+f_f(a_j)a_j)\\
(P)---s.t.\left\{ \begin{aligned} l=\sum^n_{f=1}a_jy_f\leq d \\ y_f=0,1;0\leq a_j\leq \alpha_j \end{aligned} \right.
$$
   当上层规划达到最优时，即确定了各港⼜内陆集散中⼼的容量 $a_j$，则下层规划便根据上层规划确定的各集散中⼼的容量 $a_j$， 寻求最优的运输⽅案，这⾥包含两个运输问题，⼀个是从⽣产地运到内陆集散中⼼，另⼀个是从内陆集散中⼼运往出⼜港。

   从⽣产地到内陆集散中⼼的运输问题即下层规划的第⼀个模型为：
$$
(10)----minS=\sum^n_{j=1}\sum^m_{i=1}c_{ij}x_{ij}
$$

$$
(LP1)----s.t.\left\{ \begin{aligned} \sum_{j=1}^nz_{ij}\leq a_j;j=1,\cdots,n \\  \sum_{i=1}^mx_{ij}\leq p_i;i=1,\cdots,m \\  \sum_{j=1}^n\sum_{i=1}^mx_{ij}\geq d\\ x_{ij}\geq  0;i=1,\cdots,m;j=1,\cdots,n \end{aligned} \right.
$$

   其中 $a_j$ 由上层规划决策确定。

   从内陆集散中⼼到出⼜港的运输问题即下层规划的第⼆个模型为:
$$
minS_2=\sum_{i=1}^l\sum_{j=1}^ng_{ij}z_{ij}----(11)
$$

$$
(LP2)----s.t.\left\{ \begin{aligned} \sum_{j=1}^nz_{ij}\leq a_j;j=1,\cdots,n \\  \sum_{i=1}^lx_{ij}\leq p_i;i=1,\cdots,l \\  \sum_{j=1}^n\sum_{i=1}^lx_{ij}\geq d\\ z_{ij}\geq  0;i=1,\cdots,l;j=1,\cdots,n \end{aligned} \right.
$$



   因⽽整个问题形成⼀个双层规划问题, 即求解如下的数学规划问题:
$$
minS=\sum_{f=1}^n(f_f^1y_f+f_f(a_j)a_j)+S_1(a)+S_2(a)----(12)
$$

$$
(BP)----s.t.\left\{ \begin{aligned} \sum_{j=1}^na_jy_f\geq d \\ y_f=0,1;0\leq a_j\leq \alpha_j \end{aligned} \right.
$$

   其中，$S_1(a),S_2(a)$ 由下述规划所确定：
$$
minS=\sum^n_{j=1}\sum^m_{i=1}c_{ij}x_{ij}----(10)
$$

$$
(LP1)----s.t.\left\{ \begin{aligned} \sum_{j=1}^nz_{ij}\leq a_j;j=1,\cdots,n \\  \sum_{i=1}^mx_{ij}\leq p_i;i=1,\cdots,m \\  \sum_{j=1}^n\sum_{i=1}^mx_{ij}\geq d\\ x_{ij}\geq  0;i=1,\cdots,m;j=1,\cdots,n \end{aligned} \right.
$$

$$
(11)----minS_2=\sum_{i=1}^l\sum_{j=1}^ng_{ij}z_{ij}
$$

$$
(LP2)----s.t.\left\{ \begin{aligned} \sum_{j=1}^nz_{ij}\leq a_j;j=1,\cdots,n \\  \sum_{i=1}^lx_{ij}\leq p_i;i=1,\cdots,l \\  \sum_{j=1}^n\sum_{i=1}^lx_{ij}\geq d\\ z_{ij}\geq  0;i=1,\cdots,l;j=1,\cdots,n \end{aligned} \right.
$$

   其中$a=(a_1,a_2,\cdots,a_n)^T$

   我们把上述双层规划归结成⼀个值型双层规划。上层规划确定了各个内陆集散中⼼的容量 $a_j$，下层规划根据内陆集散中⼼的容量确定最佳运输⽅案，以求得最小费⽤。

### 7. 代码实现

~~~
% 编写 M 函数 Fun.m
function F=Fun(x);
F(1)=-100*x(1)-90*x(2)-80*x(2)-70*x(4);
F(2)=3*x(2)+2*x(4);
~~~

### 8. 参考资料

1. [数学建模培训营----双层规划](https://anl.sjtu.edu.cn/mcm/docs/1%E6%A8%A1%E5%9E%8B/1%E8%BF%90%E7%AD%B9%E5%AD%A6/1%E8%A7%84%E5%88%92%E8%AE%BA/%E5%8F%8C%E5%B1%82%E8%A7%84%E5%88%92/doc)



