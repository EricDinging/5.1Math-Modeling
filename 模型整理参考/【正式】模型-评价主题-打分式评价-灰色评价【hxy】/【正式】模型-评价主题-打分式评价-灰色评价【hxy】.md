[TOC] 

## 模型-评价主题-打分式评价-灰色评价【hxy】

### 1. 模型名称

灰色综合评价法（Grey Synthetic Evaluation Method）

### 2. 适用范围

多指标综合评价，从多个候选方案中选出最佳方案

### 3. 形式

给定多个指标，多个方案

### 4. 求解方法

#### 4.1 步骤

1. 确定**最优指标集**作为**参考序列$Y_0$[^1]**
   - 方法一：采用某种确定的标准
   - 方法二：评估者公认的最优值
   - 方法三：采用公式（如果某项指标越大越好，采用最大值；越小越好，采用最小值）

$$
y_{oj} = Optimum(y_{ij}), \quad i = 1,2,...,m
$$

2. 构造**原始数据矩阵$Y$**

   $Y_0$为参考序列，$Y_1,Y_2,...Y_m$为比较序列

3. 数据**无量纲化处理（**选择其一）得到**无量纲矩阵$X$**

   - 数值均值化：将矩阵的每列所有数据除以该列数据的平均值

   $$
   \begin{cases}
   x_{ij} = \frac{y_{ij}}{\bar y_i} \quad i = 0,1,2,...,m; \; j = 0,1,2,...,n \\
   \bar y_i = \frac{1}{n} \sum_{j=1}^n y_{ij} \quad i = 0,1,2,...,m
   \end{cases}
   $$

   - 数据初值化：将矩阵的每列数据除以该列的第一个数据

   $$
   x_{ij} = \frac{y_{ij}}{y_{i1}} \quad i = 0,1,2,...,m; \; j = 0,1,2,...,n
   $$

4. 计算**灰色关联系数**，得到**评价矩阵$R$**

   - 原始公式：用**关联系数公式**计算**关联系数$r_{ij}$**

     由于关联系数衡量关联度，故最后**从大到小**对评价对象的**从优到劣**进行排序

   $$
   r_{i j}=\frac{\min _{i} \min _{j}\left|x_{0 j}-x_{i j}\right|+\theta \max _{i} \max _{j}\left|x_{0 j}-x_{i j}\right|}{\left|x_{0 j}-x_{i j}\right|+\theta \max _{i} \max _{j}\left|x_{0 j}-x_{i j}\right|} \\ \\\
   \theta \in[0,1] 为分辨系数, 常取 \theta=0.5 , \\ 
   \min _{i} \min _{j}\left|x_{0 j}-x_{i j}\right| 为两级最小差, \; 
   \max _{i} \max _{j}\left|x_{0 j}-x_{i j}\right| 为两级最 大差
   $$

   - 简化公式：用**偏离系数公式**计算**偏离系数$r_{ij}$**

     由于分母衡量$x_{ij}$相对于最优指标$x_{0j}$的偏离程度，故最后**从小到大**对评价对象的**从优到劣**进行排序

   $$
   r_{ij} = \frac{|x_{ij} - x_{0j}|}{max\{x_{ij}\} - min\{x_{ij}\}}
   $$

5. 设置**权重矩阵$W$**
   $$
   W = (w_1,w_2,...,w_n) \quad w_j \geq 0, \; j = 1,2,...,n, \; \sum_{j=1}^n w_j = 1
   $$

6. 得到**灰色关联矩阵$A$**
   $$
   A = W \times R^T \\
   a_i = \sum_{j=1}^n w_j \times (r_{ij})^T \quad i = 1,2,...,m
   $$

7. 评价对象的优劣顺序
   - 采用关联系数公式：**从大到小**为**从优到劣**
   - 采用偏离系数公式：**从小到大**位**从优到劣**

#### 4.2 实例

有A、B、C三家建筑公司参加一体育馆建筑工程项目投标，各公司投标方案的技术经济指标见下表

| 指标         | 报价/万元       | 工期/月   | 钢材用量/吨  | 木材用量/立方米 | 水泥用量/吨 | 技术水平 | 社会信誉 |
| :----------- | :-------------- | --------- | ------------ | --------------- | ----------- | -------- | -------- |
| 上下浮动限制 | 1064.94-1177.03 | 21.6-25.2 | 1300-1477.03 | 1001-1061       | 3880-4120   | 0-15     | 0-5      |
| 公司A        | 1061            | 22        | 1349         | 1074            | 4016        | 12.8     | 5        |
| 公司B        | 1015            | 22        | 1402         | 968             | 4022        | 11.2     | 4.8      |
| 公司C        | 1125            | 23        | 1234         | 1010            | 4362        | 11       | 4.7      |

1. 确定**最优指标集$Y_0$**

   采用方法三：如果某项指标越大越好，采用最大值；越小越好，采用最小值
   $$
   Y_0 = (1064.94\quad 21.6\quad 1300.0\quad 1001.0\quad 3880.0\quad 15.0\quad 5.0 )
   $$

2. 构造**原始数据矩阵$Y$**
   $$
   Y = 
   \left(
    \begin{matrix}
      1064.0 & 21.6 & 1300.0 & 1001.0 & 3880.0 & 15.0 & 5.0 \\
      1061.0 & 22.0 & 1349.0 & 1074.0 & 4016.0 & 12.8 & 5.0 \\
      1015.0 & 22.0 & 1402.0 & 968.0 & 4022.0 & 11.2 & 4.8 \\
      1125.0 & 23.0 & 1234.0 & 1010.0 & 4362.0 & 11.0 & 4.7 \\
     \end{matrix}
     \right)
   $$

3. 得到**无量纲矩阵$X$**

   采用数据均值化：将矩阵的每列所有数据除以该列数据的平均值
   $$
   X = 
   \left(
    \begin{matrix}
      0.9979 & 0.9752 & 0.9839 & 0.9879 & 0.9507 & 1.2000 & 1.0256 \\
   0.9951 & 0.9932 & 1.0210 & 1.0600 & 0.9950 & 1.0240 & 1.0256 \\
   0.9519 & 0.9932 & 1.0611 & 0.9553 & 0.9855 & 0.8960 & 0.9846 \\
   1.0551 & 1.0384 & 0.9340 & 0.9968 & 1.0688 & 0.8800 & 0.9641
     \end{matrix}
     \right)
   $$

4. 得到**评价矩阵$R$**

   采用用**关联系数公式**计算**关联系数$r_{ij}$**

   a) 计算第$i \ (i = 1,2,3)$行与第0行的差的绝对值，得到矩阵
   $$
   \left(
    \begin{matrix}
       0.0028 & 0.0180 & 0.0371 & 0.0721 & 0.0443 & 0.1760 & 0.0000 \\
       0.0460 & 0.0180 & 0.0772 & 0.0326 & 0.0348 & 0.3040 & 0.0410 \\
       0.0572 & 0.0632 & 0.0499 & 0.0089 & 0.1181 & 0.3200 & 0.0615
     \end{matrix}
     \right)
   $$
   b) 得到上述矩阵每一个第$j \ (j = 0,1,...,6)$列的最小值形成**MIN矩阵**，最大值形成**MAX矩阵**
   $$
   MIN = 
   \left(
    \begin{matrix}
      0.0028 & 0.0180 & 0.0371 & 0.0089 & 0.0348 & 0.1760 & 0.0000
     \end{matrix}
     \right) \\
     MAX = 
   \left(
    \begin{matrix}
      0.0572 & 0.0632 & 0.0772 & 0.0721 & 0.1181 & 0.3200 & 0.0615
     \end{matrix}
     \right) 
   $$
   c) 得到**MIN矩阵**的最小值作为**两级最小差**，**MAX矩阵**的最大值作为**两级最大差**
   $$
   MIN = 0.0000, \quad MAX = 0.3200
   $$
   d) 取$\theta = 0.5$，带入公式，得到**评价矩阵$R$**
   $$
   R = 
   \left(
    \begin{matrix}
      0.9828 & 0.8989 & 0.8118 & 0.6894 & 0.7832 & 0.4762 & 1.0000 \\
   0.7767 & 0.8989 & 0.6745 & 0.8307 & 0.8214 & 0.3448 & 0.7960 \\
   0.7366 & 0.7168 & 0.7623 & 0.9473 & 0.5753 & 0.3333 & 0.7223
     \end{matrix}
     \right)
   $$

5. 设置**权重矩阵$W$**
   $$
   W = 
   \left(
    \begin{matrix}
      0.3500 & 0.1500 & 0.1000 & 0.1000 & 0.1000 & 0.1500 & 0.0500
     \end{matrix}
     \right)
   $$

6. 得到**灰色关联矩阵$A$**
   $$
   A = W \times R^T = 
   \left(
    \begin{matrix}
      0.8287 & 0.7309 & 0.6800
     \end{matrix}
     \right)
   $$

7. 评价优劣

   由于$a_1>a_2>a_3$，故公司A的各项指标更接近于最优指标集，公司A应该中标

#### 4.3 代码实现 

 [grey.m](grey.m) 

代码：

```matlab
clc, clear
data = [1064.0 21.6 1300.0 1001.1 3880.0 15.0 5.0;
				1061.0 22.0 1349.0 1074.0 4016.0 12.8 5.0;
				1015.0 22.0 1402.0 968.0  4022.0 11.2 4.8;
				1125.0 23.0 1234.0 1010.0 4362.0 11.0 4.7];
% 数据预处理
% 求每一列的均值
Mean = mean(data);
% 每个元素除以均值,repmat扩充均值和data一样大
new_data = data ./ repmat(Mean,size(data,1),1);
disp('预处理后的数据矩阵为：');
disp(new_data);
% O为理想值
O = new_data(1,:);
% A为实际值
A = new_data(2:4,:);
% 计算|X0-Xi|
Abs = abs(A - repmat(O,size(A,1),1));
% 计算两级最小值
Min = min(min(Abs));
% 计算两级最大值
Max = max(max(Abs));
% 计算评价矩阵R
theta = 0.5;
R = (Min + theta * Max)./(Abs + theta * Max);
disp('评价矩阵R为：');
disp(R);
% 设置权重矩阵W
W = [0.3500 0.1500 0.1000 0.1000 0.1000 0.1500 0.0500];
% 计算灰色关联矩阵A
A = W * R';
disp('灰色关联矩阵为：');
disp(A);
```

结果：

<img src="/Users/xinyuanhe/Desktop/working/2021美赛/模型/【正式】模型-评价主题-打分式评价-灰色评价【hxy】/结果.png" alt="结果" style="zoom:50%;" />

### 5. 参考资料

1. [数模官网](https://anl.sjtu.edu.cn/mcm/docs/1%E6%A8%A1%E5%9E%8B/8%E8%AF%84%E4%BB%B7%E4%B8%BB%E9%A2%98/1%E6%89%93%E5%88%86%E5%BC%8F%E8%AF%84%E4%BB%B7/%E7%81%B0%E8%89%B2%E8%AF%84%E4%BB%B7/doc#fn-1)

2. 刘思峰：灰⾊系统理论及其应⽤（第三版）. 河南⼤学出版社，2004.
3. [Python代码实现灰色关联度综合评价](https://blog.csdn.net/weixin_43196531/article/details/106663262)
4. [Matlab代码实现灰色关联度综合评价](https://blog.csdn.net/qq_43610675/article/details/106651878)
5. [Pandas与Excel的交互](https://blog.csdn.net/tongxinzhazha/article/details/78796952)
6. 上文中其他用到的知识点

[^1]: 灰色关联分析是指通过计算比较序列和参考序列的关联度来定量分析二者间的接近程度，参考序列是被当作参考的序列，记作$Y_0$​