[toc]

#### 模型 - 评价主题 - 统计类评价 - 肯德尔和谐系数【gyj】

##### 1. 模型名称

肯德尔和谐系数检验(Kendall Coefficient of Concordance, Kendall's W)

##### 2. 适用范围

肯德尔和谐系数检验适用于**检验若干评分者对同一组样本的意见是否一致**。在<u>医学科研</u>、<u>教育检测</u>和<u>竞赛评分</u>中得到广泛应用。

##### 3. 形式

使用肯德尔和谐系数检验仅仅针对如下情况：

- 评分者数：$\ 3\leqslant K\leqslant 20 $
- 样本数：$\ N\leqslant 3 \ $

##### 4. 求解方法

4.1 概念

假设有K个评分者对N个样本进行评分，对每一个评分者，我们<u>将其所有样品打出的分数</u><u>转化成等级1~N</u>，令$\ r_{ij}(1\leq i\leq k, 1\leq j\leq N)\ $表示第i个评分者给第j个样品打出的等级。

- 样本秩和($\ R_{ij}\ $)：对每个样本j，都有K个评分员分别给出等级，将这K个等级相加称为该样本的秩和。
  $$
  R_{ij}=\sum_{i=1}^k r_{ij}
  $$

- 一组样本的秩和均值($\ \bar{R}\ $)
  $$
  \bar{R}=\frac{1}{N}\sum_{i=1}^N R_i
  $$

- 秩和的离差平方和(S)：将秩和作为主要考察的样本。**<u>K个评委评分越一致，秩和的离差平方和越大。</u>**
  $$
  S=\sum_{i=1}^N (R_i-\bar{R})^2
  $$

- 肯德尔和谐系数(W)：W反映评委的评分一致性。<u>W越大，K个评委评分越一致</u>。

  - 取值范围：$\ 0<W<1\ $

  - 计算公式：

    - 情况1：评分者评定等级无相同等级：**<u>一个</u>评分者对<u>不同样</u>本打出<u>不同的分数</u>。**
      $$
      W=\frac{S}{\frac{1}{12}K^2(N^3-N)}
      $$
      $\ K:评分者数；N:样本数\ $

    - 情况2：评分者评定等级有相同等级：**某评分者对一组样本的打分出现了<u>相同等级或分数</u>**。

      - 则我们需要<u>取秩次的均值作为他们的秩</u>。

        例：若一组样本为(2.1, 1.3, 1.6, 1.6, 0.9)

        按照从小到大的顺序给上面五个数编号，则变成 (5，2，3，4，1). 这里1.6是两个相同的数，所以本质上不可以用3，4来表示它们，故取其平均数3.5. 于是秩变成了(5, 2, 3.5, 3.5, 1)

      - 修正项($\ T_j\ $)：对第j个评分者，设其评分中出现了$\ m_j\ $种相同的评分(等级)，其中第k种相同的评分出现的次数为$\ n_{jk}\ $，则有
        $$
        T_j=\frac{1}{12}\sum_{k=1}^{m_j}(n_{jk}^3-n_{jk})
        $$

      - 肯德尔和谐系数计算公式(W)
        $$
        W=\frac{S}{\frac{1}{12}K^2(N^3-N)-K\sum_{j=1}^KT_j}
        $$

  - 检验：

    - **小样本情况：($\ 3\leq K\leq 20,3\leq N\leq 7\ $)**

      - 以离差平方和S作为检验统计量。根据K和N的值查阅下方表格得到临界值$\ S_{\alpha}\ $

        ![显著性表](C:\Users\Katrina_gao\Desktop\显著性表.png)

      - 写出拒绝域W:
        $$
        W=\{S |S\geq S_{\alpha}\}
        $$
        【注】若$\ S>S_{0.05}且 S>S_{0.01}\ $，则称W达到极显著水平，评分者的一致性很高

    - **大样本情况($\ 3 \leq K \leq 20, N\geq 8\ $)：**

      - 构造检验统计量$\ \chi^2=K(N-1)W\ $. 查[$ \chi^2 \ $分布表](https://blog.csdn.net/weixin_34268579/article/details/85414895)得到自由度为$\ N-1\ $时的临界值$\ \chi^2_{(N-1)\alpha}\ $

      - 确定拒绝域：
        $$
        W=\{\chi^2|\chi^2\geq\chi^2_{(N-1)\alpha}\}
        $$

4.2 步骤

- 提出假设：
  $$
  H_0:评分者的评分意见不一致 \\
  H_1:评分者的评分意见一致
  $$

- 取定显著性水平$\ \alpha\ $

- 计算每个样本的秩和
  $$
  R_{ij}=\sum_{i=1}^k r_{ij}
  $$

- 计算每个样本的秩和均值
  $$
  \bar{R}=\frac{1}{N}\sum_{i=1}^N R_i
  $$

- 计算秩和的离差平方和
  $$
   S=\sum_{i=1}^N (R_i-\bar{R})^2
  $$

- 根据样本数的大小，用对应的公式计算肯德尔和谐系数

  - 小样本：$\ 3\leq K\leq 20,3\leq N\leq 7\ $

    - 

    - $$
       W=\frac{S}{\frac{1}{12}K^2(N^3-N)}
      $$

    - 大样本：$\ 3 \leq K \leq 20, N\geq 8\ $

    - 

    - $$
       T_j=\frac{1}{12}\sum_{k=1}^{m_j}(n_{jk}^3-n_{jk})
      $$

      $$
      W=\frac{S}{\frac{1}{12}K^2(N^3-N)-K\sum_{j=1}^KT_j}
      $$

- 计算拒绝域

4.3 例子

题目：有A, B, C, D, E, F六位教师各自评阅五篇作文，他们给每篇作文的评定等级如下表所示，问这六位教师所评等级的一致性如何？

|   指标    |  一  |  二  |  三  |  四  |  五  |
| :-------: | :--: | :--: | :--: | :--: | :--: |
|     A     |  3   |  5   |  2   |  4   |  1   |
|     B     |  3   |  5   |  2   |  4   |  1   |
|     C     |  3   |  4   |  1   |  5   |  2   |
|     D     |  3   |  5   |  1   |  4   |  2   |
|     E     |  3   |  5   |  2   |  4   |  1   |
|     F     |  3   |  5   |  2   |  4   |  1   |
| $\ R_i\ $ |  18  |  29  |  10  |  25  |  8   |

- 提出假设：$\ H_0\ $:六位老师所评等级不具有一致性

  $\ K=6, N=5\ $

- 令显著性水平$\ \alpha = 0.05\ $

- 计算各样本的秩和$\ R_i\ $
  $$
  R_1=3+3+3+3+3+3=18;R_2=5+5+4+5+5+5=29,\cdots,R_5=1+1+3+3+1+1=8
  $$

- 计算各样本的秩和均值$\ \bar{R}\ $
  $$
  \bar{R_1}=\frac{18+29+10+25+8}{5}=18
  $$
  

- 计算离差平方和S
  $$
  S=(18-18)^2+(29-18)^2+(10-18)^2+(25-18)^2+(8-18)^2=334
  $$

- 计算和谐系数W

  - N=5, 属于小样本情况，直接带入W的公式，得到：
    $$
    W=\frac{334}{\frac{1}{12}\cdot6^2\cdot(5^3-5)}=0.928
    $$

  - 查表得到$\ S_{0.05}(6,5)=136.1<S\ $, 拒绝域: $\ W=\{S|S\geq 136.1\}\ $。又S>$\ S_{0.01}=176.1\ $

  - 结论：六位老师所评等级具有极高一致性。

4.4 代码实现

Matlab

```matlab
% 教师的打分等级
scores = [3, 5, 2, 4, 1; 3, 5, 2, 4, 1; 3, 4, 1, 5, 2; 3, 5, 1, 4, 2; 3, 5, 2, 4, 1; 3, 5, 2, 4, 1];
% 将打分等级、显著性水平和样本规模输入kendall()函数，得到检验结果
[H ,K, N, S, W, X2, bound] = kendall(scores, 0.05, 'auto')

% function [ H, K, N, S, W, X2, bound ] = kendall( scores, alpha, sizeType )

% H 表示最终所接受的假设。若为0，表示接受原假设H0；若为1，拒绝原假设H0，接受H1。
% K 评分者的数目。
% N 样本的数目。
% S 秩和的离差平方和S。
% W 肯德尔和谐系数。
% X2 大样本检验中的检验统计量X^2。（小样本中该返回值无意义，与W相等）
% bound 拒绝域的边界值。小样本情况中为S_a，大样本情况中为X^2_{N-1,a}。
% scores K*N维的矩阵。每行代表每个评分者对不同样本的评分。
% alpha 显著性水平，默认0.05。
% sizeType 样本规模类型，可取值：
%           'auto'：自动识别（默认）。
%           'small'：小样本检验。
%           'large'：大样本检验。

% 注意事项：
% 1. scores的规模中K，N应满足3<=K<=20且N>=3。
% 2. sizeType默认的自动识别以N=7为界限，即N>7采用'large'，否则采用'small'。
% 3. 由于信息有限且不清楚构造原理，本程序只提供了所能搜集到的alpha=0.05和alpha=0.01的部分《肯德尔和谐系数（W）显著性临界值表》。当小样本检验无法在该表中找到合适值时，返回值H和bound将被置为-1。

% 以下为一般过程
function [ H, K, N, S, W, X2, bound ] = kendall( scores, alpha, sizeType )

%% 参数初始化。
[K, N] = size(scores);
if nargin<2
    alpha = 0.05;   %默认显著水平。
end
if nargin<3
    sizeType = 'auto';  %默认样本规模类型。
end
if K<3||K>20||N<3   %检验scores矩阵规模的合法性。
    error('Bad data size!');
end
if strcmpi(sizeType, 'auto')    %自动识别样本规模类型。
    if N>=8
        sizeType = 'large';
    else
        sizeType = 'small';
    end
end

%% 进行秩的分配。
tieRank = tiedrank(scores')';

%% 计算秩和的离差平方和S。
Ri = sum(tieRank);  %各样本的秩和。
sumRi = sum(Ri);    %样本秩和的总和。
sumRi2 = sum(Ri.^2);    %各样本秩和的平方和。
S = sumRi2-sumRi^2/N;   %秩和的离差平方和S。

%% 计算Kendall和谐系数。
sumTj = 0;  %初始化修正项总和。
for k = 1:K
    occurs = hist(tieRank(k,:), unique(tieRank(k,:)));  %各秩的出现次数统计。
    Tj = sum(occurs.*(occurs-1).*(occurs+1))/12;    %修正项。
    sumTj = sumTj+Tj;   %更新修正项的和。
end
W = S*12/(K^2*N*(N-1)*(N+1)-K*sumTj);   %Kendall和谐系数W。

%% 计算检验统计量X^2，拒绝域边界bound以及给出决定H。
switch lower(sizeType)
    case 'small'    %小样本。
        X2 = W;
        bound = partialTable(K, N, alpha);  %尝试寻找拒绝域边界，调用函数partialTable。
        if bound == -1  %若寻找边界失败，则H=-1。
            H = -1;
        else
            H = S>=bound;   %找到边界，得到最终决定H。
        end
    case 'large'    %大样本。
        X2 = K*(N-1)*W; %检验统计量X^2。
        bound = chi2inv(1-alpha, N-1);  %拒绝域边界，由卡方分布的CDF反函数给出。
        H = X2>=bound;
    otherwise
        error('Unknown size type!');
end

%% 调用方式
% scores = [3, 5, 2, 4, 1; 3, 5, 2, 4, 1; 3, 4, 1, 5, 2; 3, 5, 1, 4, 2; 3, 5, 2, 4, 1; 3, 5, 2, 4, 1];
% [H ,K, N, S, W, X2, bound] = kendall(scores, 0.05, 'auto')
    
end

function bound = partialTable(K, N, alpha)
% function bound = partialTable(K, N, alpha)
% 查询《肯德尔和谐系数（W）显著性临界值表》的函数。

bound = -1; %默认返回-1。

valRow = -ones(1, 20);  %初始化查询列。
switch alpha
    case 0.05
        switch N
            case 3
                valRow([8, 10, 15, 20, 9, 12, 14, 16, 18]) = [48.1, 60.0, 89.8, 119.7, 54.0, 71.9, 83.8, 95.8, 107.7];
            case 4
                valRow([4, 5, 6, 8, 10, 15, 20]) = [49.5, 62.6, 75.7, 101.7, 127.8, 192.9, 258.0];
            case 5
                valRow([3, 4, 5, 6, 8, 10, 15, 20]) = [64.4, 88.4, 112.3, 136.1, 183.7, 231.2, 349.8, 468.5];
            case 6
                valRow([3, 4, 5, 6, 8, 10, 15, 20]) = [103.9, 143.3, 182.4, 221.4, 299.0, 376.7, 570.6, 764.4];
            case 7
                valRow([3, 4, 5, 6, 8, 10, 15, 20]) = [157.3, 217.0, 276.2, 335.2, 453.1, 571.0, 864.9, 158.7];
        end
    case 0.01
        switch N
            case 3
                valRow([8, 10, 15, 20, 9, 12, 14, 16, 18]) = [66.8, 85.1, 131.0, 177.0, 75.9, 103.5, 121.9, 140.2, 158.6];
            case 4
                valRow([4, 5, 6, 8, 10, 15, 20]) = [61.4, 80.5, 99.5, 137.4, 175.3, 269.8, 364.2];
            case 5
                valRow([3, 4, 5, 6, 8, 10, 15, 20]) = [75.6, 109.3, 142.8, 176.1, 242.7, 309.1, 476.2, 641.2];
            case 6
                valRow([3, 4, 5, 6, 8, 10, 15, 20]) = [122.8, 176.2, 229.4, 282.4, 388.3, 494.0, 758.2, 1022.2];
            case 7
                valRow([3, 4, 5, 6, 8, 10, 15, 20]) = [185.6, 265.0, 343.8, 422.6, 579.9, 737.0, 1129.5, 1521.9];
        end
    otherwise
        return;
end

bound = valRow(K);  %在alpha和N的查询列中查询。
        
end
```



##### 5. 补充资料

1. [数模官网 - 肯德尔和谐系数 ](https://anl.sjtu.edu.cn/mcm/docs/1模型/8评价主题/2统计类评价/肯德尔和谐系数/doc)