[TOC]

### 模型-评价主题-打分式评价-网络分析法【hxy】

#### 1. 模型名称

网络分析法（Analytic Network Process，ANP）

#### 2. 适用范围

分层的评价系统，且同一层次内部元素可能存在相互关系[^1]，低层元素对高层元素亦有支配作用

#### 3. 形式

<img src="/Users/xinyuanhe/Desktop/working/2021美赛/模型/【正式】模型-评价主题-打分式评价-网络分析法【hxy】/ANP结构.png" alt="ANP结构" style="zoom: 33%;" />

#### 4. 求解过程

##### 4.1 步骤

1. 建立不同层之间所有**判断矩阵$A_i$**，同层的**权重矩阵$C$**和**加权矩阵$A$**

2. 对**判断矩阵$A_i$**进行**一致性检验**并计算**权向量$w_i$**

   a) 判断是否为**一致阵矩阵**

   b) 计算**最大特征值$\lambda_i$**和其对应的**特征向量$B_i$**

   ​	i) 若是**一致阵矩阵**（$n$为矩阵的**阶数**）
   $$
   \lambda_i = n \\
   B_i = A_i 的第一列
   $$
   ​	ii) 若不是一致阵矩阵，求**最大特征值$\lambda_i$**和其对应的**特征向量$B_i$**

   c) 计算**一致性指标$CI_i$**（$n$为矩阵的**阶数**）
   $$
   CI_i = \frac{\lambda_i - n}{n -1}
   $$
   d) 查表得**平均随机一致性指标$RI(n)$**

   | n    | 1    | 2    | 3    | 4    | 5    | 6    | 7    | 8    | 9    |
   | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
   | RI   | 0    | 0    | 0.58 | 0.90 | 1.12 | 1.24 | 1.32 | 1.41 | 1.45 |

   e) 计算**一致性比率$CR_i$**
   $$
   CR_i = \frac{CI_i}{RI(n)}
   $$
   ​    若$CR_i < 0.1$，则通过**一致性检验**，模型有效

   f) 将**特征向量$B_i$**归一化后得到**权向量$w_i$**

3. 由**权重矩阵$C$**和**权向量$w_i$**建立**初始超矩阵$S$**
   $$
   S = 
   \begin{bmatrix}
   S_1 & S_2 \\
   S_3 & S_4
   \end{bmatrix} \\
   S_1 = C, \quad S_2 = [w_{n+1}\; w_{n+2} \; ... \;w_{2n} ], \quad S_3 = [w_1\; w_2 \; ... \;w_n], \quad S_4 = zeros(n)
   $$

4. 由**加权矩阵$A$**得到**加权超矩阵$AS$**
   $$
   AS_1 = A(1,1) * S_1, \quad AS_2 = A(1,2) * S_2, \quad AS_3 = A(2,1) * S_3, \quad AS_4 = A(2,2) * S_4 \\
   AS =
   \begin{bmatrix}
   AS_1 & AS_2 \\
   AS_3 & AS_4
   \end{bmatrix} \\
   $$

5. 将**加权超矩阵$AS$**进行**稳定处理**，得到**稳定的极限超矩阵$AS'$**

   进行归一化处理后**自乘**，重复**4～6次**，自乘公式如下：
   $$
   AS' = AS^2
   $$

6. 根据**极限超矩阵$AS'$**，得出结果

##### 4.2 实例

考虑成本、维修和耐用性三个方面，在美国车、日本车以及欧洲车之间进行选择。其中，成本、维修和耐用性之间相互影响，已知三者的权重矩阵如下：

|      | 成本 | 维修 | 耐用性 |
| ---- | ---- | ---- | ------ |
| 成本 | 0.3  | 0.2  | 0.6    |
| 维修 | 0.4  | 0.25 | 0.3    |
| 耐用 | 0.3  | 0.55 | 0.1    |

判断矩阵如下：

| 成本   | 美国车 | 欧洲车 | 日本车 |
| ------ | ------ | ------ | ------ |
| 美国车 | 1      | 5      | 3      |
| 欧洲车 | 1/5    | 1      | 1/3    |
| 日本车 | 1/3    | 3      | 1      |

| 维修   | 美国车 | 欧洲车 | 日本车 |
| ------ | ------ | ------ | ------ |
| 美国车 | 1      | 5      | 2      |
| 欧洲车 | 1/5    | 1      | 1/3    |
| 日本车 | 1/2    | 3      | 1      |

| 耐用性 | 美国车 | 欧洲车 | 日本车 |
| ------ | ------ | ------ | ------ |
| 美国车 | 1      | 1/5    | 1/3    |
| 欧洲车 | 5      | 1      | 3      |
| 日本车 | 3      | 1/3    | 1      |

| 美国车 | 成本 | 维修 | 耐用性 |
| ------ | ---- | ---- | ------ |
| 成本   | 1    | 3    | 4      |
| 维修   | 1/3  | 1    | 1      |
| 耐用性 | 1/4  | 1    | 1      |

| 欧洲车 | 成本 | 维修 | 耐用性 |
| ------ | ---- | ---- | ------ |
| 成本   | 1    | 1    | 1/2    |
| 维修   | 2    | 1    | 1/2    |
| 耐用性 | 2    | 2    | 1      |

| 日本车 | 成本 | 维修 | 耐用性 |
| ------ | ---- | ---- | ------ |
| 成本   | 1    | 2    | 1      |
| 维修   | 1/2  | 1    | 1/2    |
| 耐用性 | 1    | 2    | 1      |

加权矩阵如下：

| 0.5  |  1   |
| :--: | :--: |
| 0.5  |  0   |

1. 建立不同层之间所有**判断矩阵$A_i$**，同层的**权重矩阵$C$**和**加权矩阵$A$**
   $$
   A_1 =
   \begin{bmatrix}
   1 & 5 & 3 \\
   1/5 & 1 & 1/3 \\
   1/3 & 3 & 1\\
   \end{bmatrix} \quad
   A_2 = 
   \begin{bmatrix}
   1 & 5 & 2 \\
   1/5 & 1 & 1/3 \\
   1/2 & 3 & 1\\
   \end{bmatrix} \quad
   A_3 =
   \begin{bmatrix}
   1 & 1/5 & 1/3 \\
   5 & 1 & 3 \\
   3 & 1/3 & 1\\
   \end{bmatrix} \\
   A_4 = 
   \begin{bmatrix}
   1 & 3 & 4 \\
   1/3 & 1 & 1 \\
   1/4 & 1 & 1\\
   \end{bmatrix} \quad
   A_5 = 
   \begin{bmatrix}
   1 & 1 & 1/2 \\
   1 & 1 & 1/2 \\
   2 & 2 & 1\\
   \end{bmatrix} \quad
   A_6 = 
   \begin{bmatrix}
   1 & 2 & 1 \\
   1/2 & 1 & 1/2 \\
   1 & 2 & 1\\
   \end{bmatrix} \\
   C = 
   \begin{bmatrix}
   0.3 & 0.2 & 0.6 \\
   0.4 & 0.25 & 0.3 \\
   0.3 & 0.55 & 0.1\\
   \end{bmatrix} \quad
   A = 
   \begin{bmatrix}
   0.5 & 1 \\
   0.5 & 0
   \end{bmatrix} \quad
   $$

2. 对**判断矩阵$A_i$**进行**一致性检验**并计算**权向量$w_i$**

   a) 判断是否为**一致阵矩阵**

   ​    $A_5$和$A_6$为**一致阵矩阵**

   b)  计算**最大特征值$\lambda_i$**和其对应的**特征向量$B_i$**
   $$
   \lambda_1 = 3.0385, \; \lambda_2 = 3.0037, \; \lambda_3 = 3.0385, \lambda_4 = 3.0092 \\
   一致阵矩阵：\lambda_5 = 3, B_5 = [1,1,2]^T; \quad \lambda_6 = 3,B_6 = [1,1/2,1]^T \\
   $$
   c) 计算**一致性指标$CI_i$**（$n$为矩阵的**阶数**）
   $$
   CI_1 = 0.0193, \; CI_2 = 0.0018, \; CI_3 = 0.0193, \; CI_4 = 0.0046, \; CI_5 = 0, \; CI_6 = 0
   $$
   d) 查表得**平均随机一致性指标$RI(n)$**
   $$
   RI(3) = 0.58
   $$
   e) 计算**一致性比率$CR_i$**
   $$
   CR_1 = 0.0332, \; CR_2 = 0.0032, \; CR_3 = 0.0332, \; CR_4 = 0.0079, \; CR_5 = 0, \; CR_6 = 0
   $$
   ​    全部满足$CR_i < 0.1$，一致性检验通过，模型有效

   f) 将**特征向量$B_i$**归一化后得到**权向量$w_i$**
   $$
   w_1 =
   \begin{bmatrix}
   0.6370 \\
   0.1047 \\
   0.2583\\
   \end{bmatrix} \quad 
   w_2 = 
   \begin{bmatrix}
   0.5816 \\
   0.1095 \\
   0.3090\\
   \end{bmatrix} \quad 
   w_3 = 
   \begin{bmatrix}
   0.1047 \\
   0.6370 \\
   0.2583\\
   \end{bmatrix} \\
   w_4 = 
   \begin{bmatrix}
   0.6337 \\
   0.1919 \\
   0.1744\\
   \end{bmatrix} \quad 
   w_5 = 
   \begin{bmatrix}
   0.2500 \\
   0.2500 \\
   0.5000\\
   \end{bmatrix} \quad 
   w_6 = 
   \begin{bmatrix}
   0.4000 \\
   0.2000 \\
   0.4000\\
   \end{bmatrix} \quad
   $$

3. 由**权重矩阵$C$**和**权向量$w_i$**建立**初始超矩阵$S$**
   $$
   S =
   \begin{bmatrix}
   0.3000 & 0.2000 & 0.6000 & 0.6337 & 0.2500 & 0.4000 \\
   0.4000 & 0.2500 & 0.3000 & 0.1919 & 0.2500 & 0.2000 \\
   0.3000 & 0.5500 & 0.1000 & 0.1744 & 0.5000 & 0.4000 \\
   0.6370 & 0.5816 & 0.1047 & 0 & 0& 0\\
   0.1047 & 0.1095 & 0.6370 & 0 & 0& 0\\
   0.2583 & 0.3090 & 0.2583 & 0 & 0& 0\\
   \end{bmatrix} \quad
   $$

4. 由**加权矩阵$A$**得到**加权超矩阵$AS$**
   $$
   AS_1 = A(1,1) * S_1 = 0.5 *
   \begin{bmatrix}
   0.3000 & 0.2000 & 0.6000 \\
   0.4000 & 0.2500 & 0.3000\\
   0.3000 & 0.5500 & 0.1000\\
   \end{bmatrix} =
   \begin{bmatrix}
   0.1500 & 0.1000 & 0.3000 \\
   0.2000 & 0.1250 & 0.1500\\
   0.1500 & 0.2750 & 0.0500\\
   \end{bmatrix} \\
   AS_2 = A(1,2) * S_2 = 1 * 
   \begin{bmatrix}
   0.6337 & 0.2500 & 0.4000 \\
   0.1919 & 0.2500 & 0.2000\\
   0.1744 & 0.5000 & 0.4000\\
   \end{bmatrix} =
   \begin{bmatrix}
   0.6337 & 0.2500 & 0.4000 \\
   0.1919 & 0.2500 & 0.2000\\
   0.1744 & 0.5000 & 0.4000\\
   \end{bmatrix} \\
   AS_3 = A(2,1) * S_3 = 0.5 * 
   \begin{bmatrix}
   0.6370 & 0.5816 & 0.1047 \\
   0.1047 & 0.1095 & 0.6370\\
   0.2583 & 0.3090 & 0.2583\\
   \end{bmatrix} =
   \begin{bmatrix}
   0.3185 & 0.2908 & 0.0524 \\
   0.0524 & 0.0547 & 0.3185\\
   0.1291 & 0.1545 & 0.1291\\
   \end{bmatrix} \\
   AS_4 = A(2,2) * S_4 = 0 * 
   \begin{bmatrix}
   0 & 0 & 0 \\
   0 & 0 & 0\\
   0 & 0 & 0\\
   \end{bmatrix} =
   \begin{bmatrix}
   0 & 0 & 0 \\
   0 & 0 & 0\\
   0 & 0 & 0\\
   \end{bmatrix} \\
   AS = 
   \begin{bmatrix}
   0.1500 & 0.1000 & 0.3000 & 0.6337 & 0.2500 & 0.4000 \\
   0.2000 & 0.1250 & 0.1500 & 0.1919 & 0.2500 & 0.2000 \\
   0.1500 & 0.2750 & 0.0500 & 0.1744 & 0.5000 & 0.4000 \\
   0.3185 & 0.2908 & 0.0524 & 0.0000 & 0.0000 & 0.0000 \\
   0.0524 & 0.0547 & 0.3185 & 0.0000 & 0.0000 & 0.0000 \\
   0.1291 & 0.1545 & 0.1291 & 0.0000 & 0.0000 & 0.0000
   \end{bmatrix}
   $$

5. 将**加权超矩阵$AS$**进行**稳定处理**，得到**稳定的极限超矩阵$AS'$**
   $$
   AS' = 
   \begin{bmatrix}
   0.2776 & 0.2776 & 0.2776 & 0.2776 & 0.2776 & 0.2776 \\
   0.1794 & 0.1794 & 0.1794 & 0.1794 & 0.1794 & 0.1794 \\
   0.2097 & 0.2097 & 0.2097 & 0.2097 & 0.2097 & 0.2097 \\
   0.1515 & 0.1515 & 0.1515 & 0.1515 & 0.1515 & 0.1515 \\
   0.0911 & 0.0911 & 0.0911 & 0.0911 & 0.0911 & 0.0911 \\
   0.0906 & 0.0906 & 0.0906 & 0.0906 & 0.0906 & 0.0906
   \end{bmatrix}
   $$

6. 由$AS'$得到表格

   |        | 成本   | 维修   | 耐用性 | 美国   | 欧洲   | 日本   |
   | ------ | ------ | ------ | ------ | ------ | ------ | ------ |
   | 成本   | 0.2776 | 0.2776 | 0.2776 | 0.2776 | 0.2776 | 0.2776 |
   | 维修   | 0.1794 | 0.1794 | 0.1794 | 0.1794 | 0.1794 | 0.1794 |
   | 耐用性 | 0.2097 | 0.2097 | 0.2097 | 0.2097 | 0.2097 | 0.2097 |
   | 美国   | 0.1515 | 0.1515 | 0.1515 | 0.1515 | 0.1515 | 0.1515 |
   | 欧洲   | 0.0911 | 0.0911 | 0.0911 | 0.0911 | 0.0911 | 0.0911 |
   | 日本   | 0.0906 | 0.0906 | 0.0906 | 0.0906 | 0.0906 | 0.0906 |

   $成本-成本 = 0.2776$最大，成本为决定性因素；$美国车-美国车 = 0.1515$最大，美国车为最优选择。

##### 4.3 代码实现

 [ANP.m](ANP.m) 

```matlab
clc
clear
close all

%选车算例的解答
%% 列出所有的判断矩阵
%成本指标下美日欧三种车间的判断矩阵
A1=[1,5,3;
  1/5,1,1/3;
  1/3,3,1];
%维修指标下美日欧三种车间的判断矩阵
A2=[1,5,2;
  1/5,1,1/3;
  1/2,3,1];
%耐用性指标下美日欧三种车间的判断矩阵
A3=[1,1/5,1/3;
  5,1,3;
  3,1/3,1];
%美车三种指标下间的判断矩阵
A4=[1,3,4;
  1/3,1,1;
  1/4,1,1];
%欧车三种指标下间的判断矩阵
A5=[1,1,1/2;
  1,1,1/2;
  2,2,1];
%日车三种指标下间的判断矩阵
A6=[1,2,1;
  1/2,1,1/2;
  1,2,1];

%% 计算6个判断矩阵的特征向量
%计算6个判断矩阵的特征向量和CR
[B1,D1]=eig(A1);
[B2,D2]=eig(A2);
[B3,D3]=eig(A3);
[B4,D4]=eig(A4);
%严格得说每个判断矩阵都需要判断是不是一致阵，如果是的话就不需要再求特征向量和特征根
%即：
%由于rank(A5)=rank(A6)=1是一致阵，故下面两步不再需要
%[B5,D5]=eig(A5);
%[B6,D6]=eig(A6);
%这里作者是算出来答案跟结果不对才回去判断的一致阵，所以程序编得不是很严谨，从逻辑上来说是错误的。即看着结果推程序，所以很遗憾本程序对于解答的推广无积极意义。
%希望读者自行修改程序，先判断是否是一致阵，再计算特征根特征向量
%直接将各自的第一列设为特征向量
B5=A5(1:3,1);
B6=A6(1:3,1);

%求λmax最大特征根
lamdaMax1=max(max(D1));
lamdaMax2=max(max(D2));
lamdaMax3=max(max(D3));
lamdaMax4=max(max(D4));
%一致阵的最大特征根为阶数n
lamdaMax5=length(A5);
lamdaMax6=length(A6);

n=length(A1);
CI(1)=(lamdaMax1-n)/(n-1);
CI(2)=(lamdaMax2-n)/(n-1);
CI(3)=(lamdaMax3-n)/(n-1);
CI(4)=(lamdaMax4-n)/(n-1);
CI(5)=(lamdaMax5-n)/(n-1);
CI(6)=(lamdaMax6-n)/(n-1);
%CI=(λmax-n)/(n-1)
%对于1-9阶判断矩阵，RI值如下：
%1   2   3     4    5    6    7   8    9
%0   0  0.58 0.90 1.12 1.24 1.32 1.41 1.45
%由于n=3故RI（3）=0.58
RI=0.58;
%判断矩阵的一致性指标CI与同阶平均随机一致性指标RI之比称为随机一致性比率CR，当CR=CI/RI<0.10时，可以认为判断矩阵具有满意的一致性，否则需要调整判断矩阵。
%CR=CI/RI=0.0285/1.12=0.0255<0.10 因此，通过一致性检验。
for i=1:6
    CR(i)=CI(i)/RI;
    if CR(i)<0.1
        disp(strcat('判断矩阵',num2str(i),'通过一致性检验'));
    else
        disp(strcat('判断矩阵',num2str(i),'未通过一致性检验'));
    end
end

%权重即为最大特征根对应的特征向量W进行归一化后的结果，w=W./sum(W)
W1=B1(1:n,1);
w1=W1./sum(W1);

W2=B2(1:n,1);
w2=W2./sum(W2);

W3=B3(1:n,1);
w3=W3./sum(W3);

W4=B4(1:n,1);
w4=W4./sum(W4);

W5=B5(1:n,1);
w5=W5./sum(W5);

W6=B6(1:n,1);
w6=W6./sum(W6);
%% 输出阶段结果
CR
w1
w2
w3
w4
w5
w6
%% 计算极限超矩阵
%再考虑成本、维修和耐用性之间的相互影响，得到三者的权重矩阵
C=[0.3,0.2,0.6;
    0.4 0.25 0.3;
    0.3 0.55 0.1];
%初始超矩阵
%行列均为：成本 维修 耐用性 美 欧 日
super=[C  w4 w5  w6
       w1 w2 w3 zeros(3)];
%令归一化的排序向量A为[0.5,1;0.5,0],则加权超矩阵为[0.5*WW1 1*WW2;0.5*WW3 0*WW4]
%A=[ones(6,3)*0.5 ones(6,3)];appears to be a bad example
WW1=super(1:3,1:3);
WW2=super(1:3,4:6);
WW3=super(4:6,1:3);
WW4=super(4:6,4:6);
%powerSuper=A.*super;appears to be a bad example
powerSuper=[0.5*WW1 1*WW2;0.5*WW3 0*WW4];
ppowerSuper=powerSuper;
for m= 1:6
    P1=ppowerSuper(1:6,1);
    P2=ppowerSuper(1:6,2);
    P3=ppowerSuper(1:6,3);
    P4=ppowerSuper(1:6,4);
    P5=ppowerSuper(1:6,5);
    P6=ppowerSuper(1:6,6);
    p1=P1./sum(P1);
    p2=P2./sum(P2);
    p3=P3./sum(P3);
    p4=P4./sum(P4);
    p5=P5./sum(P5);
    p6=P6./sum(P6);
    ppowerSuper=[p1,p2,p3,p4,p5,p6]^2;
end
%% 输出最终结果
ppowerSuper
```

结果：

<img src="/Users/xinyuanhe/Desktop/working/2021美赛/模型/【正式】模型-评价主题-打分式评价-网络分析法【hxy】/结果1.png" alt="结果1" style="zoom:50%;" />

<img src="/Users/xinyuanhe/Desktop/working/2021美赛/模型/【正式】模型-评价主题-打分式评价-网络分析法【hxy】/结果2.png" alt="结果2" style="zoom:50%;" />

<img src="/Users/xinyuanhe/Desktop/working/2021美赛/模型/【正式】模型-评价主题-打分式评价-网络分析法【hxy】/结果3.png" alt="结果3" style="zoom:50%;" />

#### 5. 参考资料

1. [数模官网---网络分析法](https://anl.sjtu.edu.cn/mcm/docs/1%E6%A8%A1%E5%9E%8B/8%E8%AF%84%E4%BB%B7%E4%B8%BB%E9%A2%98/1%E6%89%93%E5%88%86%E5%BC%8F%E8%AF%84%E4%BB%B7/%E7%BD%91%E7%BB%9C%E5%88%86%E6%9E%90%E6%B3%95/doc)

[^1]: 区别于AHP，AHP假设同一层次的元素视为相互独立